#
# IHA library will be built only when IPT is enabled
#

LOCAL_PATH := $(call my-dir)

#
# Install the prebuilt IHA library
#
include $(CLEAR_VARS)
LOCAL_MODULE := libiha
LOCAL_MODULE_SUFFIX := .so
LOCAL_SRC_FILES := libiha.so
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := SHARED_LIBRARIES
LOCAL_MODULE_PATH := $(TARGET_OUT_SHARED_LIBRARIES)
include $(BUILD_PREBUILT)

#
# Install EPID certificates for IPT's EPID provisioning
#
include $(CLEAR_VARS)
LOCAL_MODULE := EPIDClientConfig.txt
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := epid_paramcert.dat
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_VLV2EPIDPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_VLV2EPIDPREPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

define build_single_x509_cert
 include $(CLEAR_VARS)
 LOCAL_MODULE := Group_$(1)_Public_Key.cer
 LOCAL_SRC_FILES := Group_$(1)_Public_Key.cer
 LOCAL_MODULE_TAGS := optional
 LOCAL_MODULE_CLASS := ETC
 LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
 include $(BUILD_PREBUILT)
endef

X509_CERT_LIST :=  1244                2167 2168 2169 \
    2170 2171 2172 2173 2174 2175 2176 2177 2178 2179 \
    2180 2181 2182 2183 2184 2185 2186 2187 2188 2189 \
    2190 2191 2192 2193 2194 2195 2196 2197 2198 2199 \
    2200 2201 2202 2203 2204 2205 2206 2207 2208 2209 \
    2210 2211 2212 2213 2214 2215 2216 2217 2218 2219 \
    2220 2221 2222 2223 2224 2225 2226 2227 2228 2229 \
    2230 2231 2232 2233 2234 2235 2236 2237 2238 2239 \
    2240 2241 2242 2243 2244 2245 2246 2247 2248 2249 \
    2250 2251 2252 2253 2254 2255 2256 2257 2258 2259 \
    2260 2261 2262 2263 2264 2265 2266
$(foreach item,$(X509_CERT_LIST),$(eval $(call build_single_x509_cert,$(item))))
