#
# IHA library will be built only when IPT is enabled
#

LOCAL_PATH := $(call my-dir)

#
# Install EPID certificates for IPT's EPID provisioning
#
include $(CLEAR_VARS)
LOCAL_MODULE := EPIDClientConfig.txt
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := BaytrailCherrytrail.csv
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := epid_paramcert.dat
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_VLV2EPIDPREPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_VLV2EPIDPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_BYTEPIDPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_CHTEPIDPREPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := PAVP_Group_CHTEPIDPROD_Public_Keys.bin
LOCAL_SRC_FILES := $(LOCAL_MODULE)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
include $(BUILD_PREBUILT)

X509_CERT_LIST :=  \
    1244                               2167 2168 2169 \
    2170 2171 2172 2173 2174 2175 2176 2177 2178 2179 \
    2180 2181 2182 2183 2184 2185 2186 2187 2188 2189 \
    2190 2191 2192 2193 2194 2195 2196 2197 2198 2199 \
    2200 2201 2202 2203 2204 2205 2206 2207 2208 2209 \
    2210 2211 2212 2213 2214 2215 2216 2217 2218 2219 \
    2220 2221 2222 2223 2224 2225 2226 2227 2228 2229 \
    2230 2231 2232 2233 2234 2235 2236 2237 2238 2239 \
    2240 2241 2242 2243 2244 2245 2246 2247 2248 2249 \
    2250 2251 2252 2253 2254 2255 2256 2257 2258 2259 \
    2260 2261 2262 2263 2264 2265 2266           2669 \
    2670 2671 2672 2673 2674 2675 2676 2677 2678 2679 \
    2680 2681 2682 2683 2684 2685 2686 2687 2688 2689 \
    2690 2691 2692 2693 2694 2695 2696 2697 2698 2699 \
    2700 2701 2702 2703 2704 2705 2706 2707 2708 2709 \
    2710 2711 2712 2713 2714 2715 2716 2717 2718 2719 \
    2720 2721 2722 2723 2724 2725 2726 2727 2728 2729 \
    2730 2731 2732 2733 2734 2735 2736 2737 2738 2739 \
    2740 2741 2742 2743 2744 2745 2746 2747 2748 2749 \
    2750 2751 2752 2753 2754 2755 2756 2757 2758 2759 \
    2760 2761 2762 2763 2764 2765 2766 2767 2768      \
    3340 3341 3342 3343 3344 3345 3346 3347 3348 3349 \
    3350 3351 3352 3353 3354 3355 3356 3357 3358 3359 \
    3360 3361 3362 3363 3364 3365 3366 3367 3368 3369 \
    3370 3371 3372 3373 3374 3375 3376 3377 3378 3379 \
    3380 3381 3382 3383 3384 3385 3386 3387 3388 3389 \
    3390 3391 3392 3393 3394 3395 3396 3397 3398 3399 \
    3400 3401 3402 3403 3404 3405 3406 3407 3408 3409 \
    3410 3411 3412 3413 3414 3415 3416 3417 3418 3419 \
    3420 3421 3422 3423 3424 3425 3426 3427 3428 3429 \
    3430 3431 3432 3433 3434 3435 3436 3437 3438 3439 \
    3440

define build_single_x509_cert
 include $(CLEAR_VARS)
 LOCAL_MODULE := Group_$(1)_Public_Key.cer
 LOCAL_SRC_FILES := Group_$(1)_Public_Key.cer
 LOCAL_MODULE_TAGS := optional
 LOCAL_MODULE_CLASS := ETC
 LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/security/EPID_certs
 include $(BUILD_PREBUILT)
endef

$(foreach item,$(X509_CERT_LIST),$(eval $(call build_single_x509_cert,$(item))))
include $(CLEAR_VARS)
LOCAL_MODULE := epid_certificates
LOCAL_MODULE_TAGS := optional
LOCAL_REQUIRED_MODULES += $(addprefix Group_, $(addsuffix _Public_Key.cer, $(X509_CERT_LIST)))
LOCAL_REQUIRED_MODULES += EPIDClientConfig.txt
LOCAL_REQUIRED_MODULES += BaytrailCherrytrail.csv
LOCAL_REQUIRED_MODULES += epid_paramcert.dat
LOCAL_REQUIRED_MODULES += PAVP_Group_VLV2EPIDPREPROD_Public_Keys.bin
LOCAL_REQUIRED_MODULES += PAVP_Group_VLV2EPIDPROD_Public_Keys.bin
LOCAL_REQUIRED_MODULES += PAVP_Group_BYTEPIDPROD_Public_Keys.bin
LOCAL_REQUIRED_MODULES += PAVP_Group_CHTEPIDPREPROD_Public_Keys.bin
LOCAL_REQUIRED_MODULES += PAVP_Group_CHTEPIDPROD_Public_Keys.bin
include $(BUILD_PHONY_PACKAGE)
